{% extends 'portal/base.html' %}
{% load i18n %}
{% block content %}
<h2 class="text-xl md:text-2xl font-bold mb-4 md:mb-6">{% trans "مرحباً بك،" %} {{ user.tenant.name }}!</h2>

{% if error %}
<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6" role="alert">
    <strong class="font-bold text-sm md:text-base">{% trans "خطأ:" %}</strong>
    <span class="block sm:inline text-sm md:text-base">{{ error }}</span>
</div>
{% endif %}

{% if lease %}
<div class="bg-white p-4 md:p-6 rounded-lg shadow-md mb-6 md:mb-8">
    <h3 class="text-lg md:text-xl font-bold text-[#993333] border-b pb-2 mb-4">{% trans "تفاصيل عقدك النشط" %}</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
        <div>
            <span class="text-gray-500 text-xs md:text-sm">{% trans "رقم العقد" %}:</span>
            <p class="font-bold text-base md:text-lg">{{ lease.contract_number }}</p>
        </div>
        <div>
            <span class="text-gray-500 text-xs md:text-sm">{% trans "الوحدة" %}:</span>
            <p class="font-bold text-base md:text-lg">{{ lease.unit }}</p>
        </div>
        <div>
            <span class="text-gray-500 text-xs md:text-sm">{% trans "الإيجار الشهري" %}:</span>
            <p class="font-bold text-base md:text-lg">{{ lease.monthly_rent|floatformat:2 }} {% trans "ر.ع" %}</p>
        </div>
        <div>
            <span class="text-gray-600 text-xs md:text-sm">{% trans "تاريخ الانتهاء" %}:</span>
            <p class="font-bold text-base md:text-lg">{{ lease.end_date|date:"d M Y" }}</p>
        </div>
    </div>
</div>

<div class="bg-white p-4 md:p-6 rounded-lg shadow-md mb-6 md:mb-8">
    <h3 class="text-lg md:text-xl font-bold text-[#993333] border-b pb-2 mb-4">{% trans "الدفعات" %}</h3>
    <div class="overflow-x-auto">
        <table class="w-full text-xs md:text-sm min-w-max">
            <thead class="bg-gray-50">
                <tr>
                    <th class="text-start p-2 md:p-3 font-semibold">{% trans "الشهر/السنة" %}</th>
                    <th class="text-start p-2 md:p-3 font-semibold">{% trans "الإيجار المستحق" %}</th>
                    <th class="text-start p-2 md:p-3 font-semibold">{% trans "المدفوع" %}</th>
                    <th class="text-start p-2 md:p-3 font-semibold">{% trans "الرصيد المتبقي" %}</th>
                    <th class="text-start p-2 md:p-3 font-semibold">{% trans "الحالة" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for month in payment_summary %}
                <tr class="border-b border-gray-50">
                    <td class="p-2 md:p-3 font-mono">{{ month.month_name }} {{ month.year }}</td>
                    <td class="p-2 md:p-3 font-mono">{{ month.rent_due|floatformat:2 }} {% trans "ر.ع" %}</td>
                    <td class="p-2 md:p-3 font-mono text-green-700">{{ month.amount_paid|floatformat:2 }} {% trans "ر.ع" %}</td>
                    <td class="p-2 md:p-3 font-mono {% if month.balance > 0 %}text-red-500 font-bold{% endif %}">{{ month.balance|floatformat:2 }} {% trans "ر.ع" %}</td>
                    <td class="p-2 md:p-3">
                        {% if month.status == 'paid' %}
                        <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">{% trans "مدفوع" %}</span>
                        {% elif month.status == 'partial' %}
                        <span class="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">{% trans "جزئي" %}</span>
                        {% elif month.status == 'due' %}
                        <span class="px-2 py-1 text-xs rounded-full bg-red-100 text-red-800">{% trans "مستحق" %}</span>
                        {% elif month.status == 'upcoming' %}
                        <span class="px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800">{% trans "قادم" %}</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="py-2 text-center text-gray-500">{% trans "لا توجد دفعات مسجلة." %}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8">
    <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 gap-2">
            <h3 class="text-lg md:text-xl font-bold text-[#993333]">{% trans "طلبات الصيانة" %}</h3>
            <a href="{% url 'maintenance_list' %}" class="text-blue-600 hover:underline text-sm md:text-base">{% trans "عرض جميع الطلبات" %}</a>
        </div>
        <ul class="space-y-3">
            {% for req in maintenance_requests %}
            <li class="flex justify-between items-center">
                <div>
                    <p class="font-semibold text-sm md:text-base">{{ req.title }}</p>
                    <p class="text-xs md:text-sm text-gray-500">{{ req.reported_date|date:"d M Y" }}</p>
                </div>
                <span class="px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800">{{ req.get_status_display }}</span>
            </li>
            {% empty %}
            <li class="text-gray-500 text-sm">{% trans "لا توجد طلبات صيانة." %}</li>
            {% endfor %}
        </ul>
    </div>
    
    <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
        <h3 class="text-lg md:text-xl font-bold text-[#993333] border-b pb-2 mb-4">{% trans "المستندات" %}</h3>
        <ul class="space-y-2">
            {% for doc in documents %}
            <li class="bg-gray-50 hover:bg-gray-100 p-3 rounded-md">
                <a href="{{ doc.file.url }}" target="_blank" class="text-blue-600 hover:underline flex items-center text-sm md:text-base">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 me-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4 2a8 8 0 100 16 8 8 0 000-16zM8 9a2 2 0 100-4 2 2 0 000 4zM9 11a1 1 0 011-1h2a1 1 0 110 2h-2a1 1 0 01-1-1z" clip-rule="evenodd" />
                    </svg>
                    {{ doc.title }}
                </a>
            </li>
            {% empty %}
            <li class="text-center text-gray-500 py-4 text-sm">{% trans "لا توجد مستندات." %}</li>
            {% endfor %}
        </ul>
    </div>
</div>

{% else %}
<div class="bg-white p-6 md:p-8 rounded-lg shadow-md mb-6 md:mb-8">
    <h3 class="text-lg md:text-xl font-bold text-[#993333] border-b pb-2 mb-4">{% trans "لا يوجد عقد نشط" %}</h3>
    <p class="text-gray-500 text-sm md:text-base">{% trans "ليس لديك أي عقود إيجار نشطة مرتبطة بحسابك في الوقت الحالي." %}</p>
</div>
{% endif %}
{% endblock %}
