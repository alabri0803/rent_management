{% extends 'dashboard/base.html' %}
{% load i18n %}
{% block title %}{% trans "إدارة الشيكات" %}{% endblock %}
{% block content %}
<div class="flex justify-between items-center mb-6">
    <h2 class="text-3xl font-bold text-gray-800">{% trans "إدارة الشيكات" %}</h2>
</div>

<div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
    <a href="?status=" class="card text-center p-4 hover:shadow-lg transition {% if not status_filter %}border-2 border-blue-500{% endif %}">
        <div class="text-3xl font-bold text-blue-600">{{ total_count }}</div>
        <div class="text-gray-600 mt-2">{% trans "جميع الشيكات" %}</div>
    </a>
    
    <a href="?status=pending" class="card text-center p-4 hover:shadow-lg transition {% if status_filter == 'pending' %}border-2 border-yellow-500{% endif %}">
        <div class="text-3xl font-bold text-yellow-600">{{ pending_count }}</div>
        <div class="text-gray-600 mt-2">{% trans "شيكات معلقة" %}</div>
    </a>
    
    <a href="?status=cashed" class="card text-center p-4 hover:shadow-lg transition {% if status_filter == 'cashed' %}border-2 border-green-500{% endif %}">
        <div class="text-3xl font-bold text-green-600">{{ cashed_count }}</div>
        <div class="text-gray-600 mt-2">{% trans "شيكات مصروفة" %}</div>
    </a>
    
    <a href="?status=returned" class="card text-center p-4 hover:shadow-lg transition {% if status_filter == 'returned' %}border-2 border-red-500{% endif %}">
        <div class="text-3xl font-bold text-red-600">{{ returned_count }}</div>
        <div class="text-gray-600 mt-2">{% trans "شيكات مرتجعة" %}</div>
    </a>
</div>

<div class="card overflow-hidden">
    <table class="w-full text-start">
        <thead class="bg-gray-50 border-b">
            <tr>
                <th class="p-4">{% trans "رقم الشيك" %}</th>
                <th class="p-4">{% trans "المستأجر" %}</th>
                <th class="p-4">{% trans "المبلغ" %}</th>
                <th class="p-4">{% trans "تاريخ الشيك" %}</th>
                <th class="p-4">{% trans "البنك" %}</th>
                <th class="p-4">{% trans "الحالة" %}</th>
                <th class="p-4">{% trans "إجراءات" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for check in checks %}
            <tr class="border-b hover:bg-gray-50">
                <td class="p-4 font-semibold">#{{ check.check_number }}</td>
                <td class="p-4">{{ check.lease.tenant.name }}</td>
                <td class="p-4 font-mono">{{ check.amount|floatformat:2 }} ر.ع</td>
                <td class="p-4">{{ check.check_date|date:"d/m/Y" }}</td>
                <td class="p-4">{{ check.bank_name }}</td>
                <td class="p-4">
                    {% if check.check_status == 'pending' %}
                        <span class="inline-block px-3 py-1 text-sm rounded-full bg-yellow-100 text-yellow-800">
                            {{ check.get_check_status_display }}
                        </span>
                    {% elif check.check_status == 'cashed' %}
                        <span class="inline-block px-3 py-1 text-sm rounded-full bg-green-100 text-green-800">
                            {{ check.get_check_status_display }}
                        </span>
                    {% elif check.check_status == 'returned' %}
                        <span class="inline-block px-3 py-1 text-sm rounded-full bg-red-100 text-red-800">
                            {{ check.get_check_status_display }}
                        </span>
                    {% endif %}
                </td>
                <td class="p-4 space-x-2 rtl:space-x-reverse">
                    <a href="{% url 'check_status_update' check.pk %}" class="text-blue-600 hover:underline">
                        {% trans "تحديث الحالة" %}
                    </a>
                    <a href="{% url 'payment_update' check.pk %}" class="text-green-600 hover:underline">
                        {% trans "تعديل" %}
                    </a>
                    <a href="{% url 'payment_receipt' check.pk %}" target="_blank" class="text-purple-600 hover:underline">
                        {% trans "سند قبض" %}
                    </a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="p-6 text-center text-gray-500">
                    {% trans "لا توجد شيكات" %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if is_paginated %}
<div class="flex justify-center mt-6">
    <nav class="flex gap-2">
        {% if page_obj.has_previous %}
            <a href="?page=1{% if status_filter %}&status={{ status_filter }}{% endif %}" class="px-3 py-2 border rounded hover:bg-gray-50">{% trans "الأولى" %}</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}" class="px-3 py-2 border rounded hover:bg-gray-50">{% trans "السابقة" %}</a>
        {% endif %}
        
        <span class="px-3 py-2">{% trans "صفحة" %} {{ page_obj.number }} {% trans "من" %} {{ page_obj.paginator.num_pages }}</span>
        
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}" class="px-3 py-2 border rounded hover:bg-gray-50">{% trans "التالية" %}</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if status_filter %}&status={{ status_filter }}{% endif %}" class="px-3 py-2 border rounded hover:bg-gray-50">{% trans "الأخيرة" %}</a>
        {% endif %}
    </nav>
</div>
{% endif %}
{% endblock %}
